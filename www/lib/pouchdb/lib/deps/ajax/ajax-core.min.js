"use strict";function ajax(e,t){function r(t,n,r){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(i){return r(i)}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?errors.generateErrorFromResponse(e):e})),e.binary&&applyTypeToBuffer(t,n),r(null,t,n)}function i(e,t){var n,r;if(e.code&&e.status){var i=new Error(e.message||e.code);return i.status=e.status,t(i)}try{n=JSON.parse(e.responseText),r=errors.generateErrorFromResponse(n)}catch(a){r=errors.generateErrorFromResponse(e)}t(r)}e=utils.clone(e);var n={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return e=utils.extend(!0,n,e),e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),request(e,function(n,a,o){if(n)return n.status=a?a.statusCode:400,i(n,t);var s,u=a.headers&&a.headers["content-type"],c=o||defaultBody();if(e.binary||!e.json&&e.processData||"object"==typeof c||!(/json/.test(u)||/^[\s]*\{/.test(c)&&/\}[\s]*$/.test(c))||(c=JSON.parse(c)),a.statusCode>=200&&a.statusCode<300)r(c,a,t);else{try{c=JSON.parse(c.toString())}catch(l){}s=errors.generateErrorFromResponse(c),s.status=a.statusCode,t(s)}})}var request=require("request"),errors=require("./../errors"),utils=require("../../utils"),applyTypeToBuffer=require("./applyTypeToBuffer"),defaultBody=require("./defaultBody");module.exports=ajax;
