"use strict";function processDocs(e,t,n,r,i,a,o,s){function u(e,t,n){var r=merge.winningRev(e.metadata),s=isDeleted(e.metadata,r);if("was_delete"in o&&s)return i[t]=errors.error(errors.MISSING_DOC,"deleted"),n();var u=s?0:1;a(e,r,s,s,!1,u,t,n)}function p(){++f===d&&s&&s()}var c=o.new_edits,l=new Map,f=0,d=e.length;e.forEach(function(e,n){if(e._id&&isLocalId(e._id))return void t[e._deleted?"_removeLocal":"_putLocal"](e,{ctx:r},function(e){e?i[n]=e:i[n]={ok:!0},p()});var a=e.metadata.id;l.has(a)?(d--,l.get(a).push([e,n])):l.set(a,[[e,n]])}),l.forEach(function(e,t){function o(){++r<e.length?s():p()}function s(){var s=e[r],l=s[0],f=s[1];n.has(t)?updateDoc(n.get(t),l,i,f,o,a,c):u(l,f,o)}var r=0;s()})}var merge=require("../../merge"),errors=require("../errors"),updateDoc=require("./updateDoc"),isDeleted=require("./isDeleted"),isLocalId=require("./isLocalId"),collections=require("pouchdb-collections"),Map=collections.Map;module.exports=processDocs;
