"use strict";function intToString(e){return String.fromCharCode(255&e)+String.fromCharCode(e>>>8&255)+String.fromCharCode(e>>>16&255)+String.fromCharCode(e>>>24&255)}function rawToBase64(e){for(var t="",n=0,r=e.length;r>n;n++)t+=intToString(e[n]);return base64.btoa(t)}function appendBuffer(e,t,n,r){(n>0||r<t.byteLength)&&(t=new Uint8Array(t,n,Math.min(r,t.byteLength)-n)),e.append(t)}function appendString(e,t,n,r){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t)}var toPromise=require("./toPromise"),base64=require("./binary/base64"),Md5=require("spark-md5"),setImmediateShim=global.setImmediate||global.setTimeout,MD5_CHUNK_SIZE=32768;module.exports=toPromise(function(e,t){function c(){var n=o*i,r=n+i;if(o++,a>o)u(s,e,n,r),setImmediateShim(c);else{u(s,e,n,r);var l=s.end(!0),f=rawToBase64(l);t(null,f),s.destroy()}}var n="string"==typeof e,r=n?e.length:e.byteLength,i=Math.min(MD5_CHUNK_SIZE,r),a=Math.ceil(r/i),o=0,s=n?new Md5:new Md5.ArrayBuffer,u=n?appendString:appendBuffer;c()});
