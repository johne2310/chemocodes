"use strict";function isGenOne(e){return/^1-/.test(e)}function getDocs(e,t,n){function i(t,i){var a={revs:!0,open_revs:i,attachments:!0,binary:!0};return e.get(t,a).then(function(e){if(n.cancelled)throw new Error("cancelled");e.forEach(function(e){e.ok&&r.push(e.ok)})})}function a(e){for(var n=t[e].missing,r=[],a=0;a<n.length;a+=MAX_SIMULTANEOUS_REVS){var o=n.slice(a,Math.min(n.length,a+MAX_SIMULTANEOUS_REVS));r.push(o)}return Promise.all(r.map(function(t){return i(e,t)}))}function o(){var e=Object.keys(t);return Promise.all(e.map(a))}function s(e){return e._attachments&&Object.keys(e._attachments).length>0}function u(i){return e.allDocs({keys:i,include_docs:!0}).then(function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){!e.deleted&&e.doc&&isGenOne(e.value.rev)&&!s(e.doc)&&(r.push(e.doc),delete t[e.id])})})}function c(){var e=Object.keys(t).filter(function(e){var n=t[e].missing;return 1===n.length&&isGenOne(n[0])});return e.length>0?u(e):void 0}function l(){return r}t=clone(t);var r=[];return Promise.resolve().then(c).then(o).then(l)}var utils=require("./../utils"),clone=utils.clone,Promise=utils.Promise,MAX_SIMULTANEOUS_REVS=50;module.exports=getDocs;
