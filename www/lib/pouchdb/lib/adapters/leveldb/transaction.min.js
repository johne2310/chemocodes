"use strict";function getCacheFor(e,t){var n=t.prefix(),r=e._cache,i=r.get(n);return i||(i=new utils.Map,r.set(n,i)),i}function LevelTransaction(){this._batch=[],this._cache=new utils.Map}var utils=require("../../utils");LevelTransaction.prototype.get=function(e,t,n){var r=getCacheFor(this,e),i=r.get(t);return i?process.nextTick(function(){n(null,i)}):null===i?process.nextTick(function(){n({name:"NotFoundError"})}):void e.get(t,function(e,i){return e?("NotFoundError"===e.name&&r.set(t,null),n(e)):(r.set(t,i),void n(null,i))})},LevelTransaction.prototype.batch=function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t],i=getCacheFor(this,r.prefix);"put"===r.type?i.set(r.key,r.value):i.set(r.key,null)}this._batch=this._batch.concat(e)},LevelTransaction.prototype.execute=function(e,t){for(var n=new utils.Set,r=[],i=this._batch.length-1;i>=0;i--){var a=this._batch[i],o=a.prefix.prefix()+"Ã¿"+a.key;n.has(o)||(n.add(o),r.push(a))}e.batch(r,t)},module.exports=LevelTransaction;
